{% extends "layout.html" %}

{% block title %}
  {% if current_lang == 'sr' %}
    {{ therapist.name }} – Terapeut
  {% else %}
    {{ therapist.name }} – Therapist
  {% endif %}
{% endblock %}

{% block content %}
{% set is_sr = (current_lang == 'sr') %}

{# Pull localized arrays with SR fallback via tfield helper from app.py #}
{% set titles = tfield(therapist, 'titles', current_lang) %}
{% set focus  = tfield(therapist, 'focus',  current_lang) %}
{% set bio    = tfield(therapist, 'bio',    current_lang) %}

<main>

  <!-- =============== HERO / PROFILE =============== -->
  <section class="section section--about" id="therapist-hero">
    <div class="container">
      <div class="about-grid" style="align-items:center;">
        <!-- Profile Card -->
        <div class="about-card" aria-hidden="true">
          <h1>{{ therapist.name }}</h1>
        </div>

        <!-- Image + headings -->
        <div class="therapist" style="aspect-ratio:auto;">
          <img
            class="therapist-image"
            src="{{ url_for('static', filename=therapist.image) }}"
            alt="{{ therapist.name }} — {{ 'profilna fotografija' if is_sr else 'profile photo' }}"
            style="border-radius:70px; max-height:520px; object-fit:cover;"
          >
          <div class="therapist-text" style="bottom:-50px;">
            <p>{{ therapist.name }}</p>
            {% for t in titles %}
              <p>{{ t }}</p>
            {% endfor %}
          </div>
        </div>

        <!-- Summary / badges -->
        <div class="prices-text-content" style="grid-column:1 / -1;">
          <h2 style="margin-top:0;">{{ 'O terapeutu' if is_sr else 'About the therapist' }}</h2>

          {% for paragraph in bio %}
            <p>{{ paragraph }}</p>
          {% endfor %}

          {% if focus and focus|length %}
            <h3 style="margin-top:1rem;">{{ 'Fokus rada' if is_sr else 'Areas of focus' }}</h3>
            <div style="display:flex; flex-wrap:wrap; gap:.5rem;">
              {% for tag in focus %}
              <span style="background:#5b703c; color:white; padding:.4rem .7rem; border-radius:999px; font-size:.95rem;">
                {{ tag }}
              </span>
              {% endfor %}
            </div>
          {% endif %}

          <div style="margin-top:1.2rem;">
            <a href="#contact" style="display:inline-block; background:#d7e8be; color:#5b703c; padding:.7rem 1rem; border-radius:.6rem; text-decoration:none; font-weight:700;">
              {{ 'Zakažite seansu' if is_sr else 'Book a session' }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Wave: hero -> contact -->
  <div class="wave-sep" style="--top:#d7e8be; --bottom:#889b6d;">
    <svg viewBox="0 0 1440 200" preserveAspectRatio="none" aria-hidden="true">
      <rect width="1440" height="200" fill="var(--bottom)"></rect>
      <path d="M0,60 C240,140 600,0 900,60 C1120,105 1280,120 1440,80 L1440,0 L0,0 Z" fill="var(--top)"></path>
    </svg>
  </div>

  <!-- =============== CONTACT (same as index) =============== -->
  <section id="contact" class="section section--contact">
    <div class="container">
      <div id="contact-info"></div>
      <div class="form">
        <form action="https://usebasin.com/f/52e7368d9d9c" method="POST" enctype="multipart/form-data" id="form">
          <label for="contact-name">{{ 'Vaše ime' if is_sr else 'First name' }}</label>
          <input type="text" name="name" id="contact-name">

          <label for="contact-lastname">{{ 'Vaše prezime' if is_sr else 'Last name' }}</label>
          <input type="text" name="lastname" id="contact-lastname">

          <label for="contact-email">Email</label>
          <input type="email" name="email" id="contact-email" required>

          <label for="contact-phone">{{ 'Telefon' if is_sr else 'Phone' }}</label>
          <input type="text" name="phone" id="contact-phone">

          <label for="contact-title">{{ 'Naslov' if is_sr else 'Subject' }}</label>
          <input type="text" name="title" id="contact-title">

          <label for="contact-message">{{ 'Poruka' if is_sr else 'Message' }}</label>
          <textarea name="message" id="contact-message"></textarea>

          <button type="submit">{{ 'Pošalji' if is_sr else 'Send' }}</button>
        </form>
      </div>
    </div>
  </section>

</main>

{% if therapist %}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Person",
  "name":"{{ therapist.name }}",
  "image":"https://your-domain.com/{{ url_for('static', filename=therapist.image) }}",
  "jobTitle":"{{ therapist.titles[0] if therapist.titles else 'Psychologist' }}",
  "affiliation":{"@type":"Organization","name":"RESET"},
  "knowsAbout":[{% for tag in therapist.focus %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}],
  "worksFor":{"@type":"Organization","name":"RESET"},
  "url":"{{ request.url }}"
}
</script>
<script src="{{ url_for('static', filename='js/nav.js') }}"></script>
{% endif %}

{% endblock %}
