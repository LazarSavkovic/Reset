{% extends "layout.html" %}

{% block title %}
  {% if current_lang == 'sr' %}
    {{ therapist.name }} – Terapeut
  {% else %}
    {{ therapist.name }} – Therapist
  {% endif %}
{% endblock %}

{% block content %}
{% set is_sr = (current_lang == 'sr') %}

{# Pull localized arrays with SR fallback via tfield helper from app.py #}
{% set titles = tfield(therapist, 'titles', current_lang) %}
{% set focus  = tfield(therapist, 'focus',  current_lang) %}
{% set bio    = tfield(therapist, 'bio',    current_lang) %}

<main>

  <!-- =============== HERO / PROFILE =============== -->
  <section class="section section--about" id="therapist-hero">
    <div class="container">
      <div class="about-grid" style="align-items:center;">
        <!-- Profile Card -->
        <div class="about-card" aria-hidden="true">
          <h1>{{ therapist.name }}</h1>
        </div>

        <!-- Image + headings -->
        <div class="therapist" style="aspect-ratio:auto;">
          <img
            class="therapist-image"
            src="{{ url_for('static', filename=therapist.image) }}"
            alt="{{ therapist.name }} — {{ 'profilna fotografija' if is_sr else 'profile photo' }}"
            style="border-radius:70px; max-height:520px; object-fit:cover;"
          >
          <div class="therapist-text" style="bottom:-50px;">
            <p>{{ therapist.name }}</p>
            {% for t in titles %}
              <p>{{ t }}</p>
            {% endfor %}
          </div>
        </div>

        <!-- Summary / badges -->
        <div class="prices-text-content" style="grid-column:1 / -1;">
          <h2 style="margin-top:0;">{{ 'O terapeutu' if is_sr else 'About the therapist' }}</h2>

          {% for paragraph in bio %}
            <p>{{ paragraph }}</p>
          {% endfor %}

          {% if focus and focus|length %}
            <h3 style="margin-top:1rem;">{{ 'Fokus rada' if is_sr else 'Areas of focus' }}</h3>
            <div style="display:flex; flex-wrap:wrap; gap:.5rem;">
              {% for tag in focus %}
              <span style="background:#5b703c; color:white; padding:.4rem .7rem; border-radius:999px; font-size:.95rem;">
                {{ tag }}
              </span>
              {% endfor %}
            </div>
          {% endif %}

          <div style="margin-top:1.2rem;">
            <a href="#contact" style="display:inline-block; background:#d7e8be; color:#5b703c; padding:.7rem 1rem; border-radius:.6rem; text-decoration:none; font-weight:700;">
              {{ 'Zakažite seansu' if is_sr else 'Book a session' }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Wave: hero -> details -->
  <div class="wave-sep" style="--top:#d7e8be; --bottom:#f5ffe5;">
    <svg viewBox="0 0 1440 200" preserveAspectRatio="none" aria-hidden="true">
      <rect width="1440" height="200" fill="var(--bottom)"></rect>
      <path d="M0,60 C240,140 600,0 900,60 C1120,105 1280,120 1440,80 L1440,0 L0,0 Z" fill="var(--top)"></path>
    </svg>
  </div>

  <!-- =============== DETAILS (re-using price card styling) =============== -->
  <section class="section section--prices" id="therapist-details">
    <div class="container">
      <div class="prices-content">
        <div class="prices-single">
          <div class="prices-text-content">
            <h3>{{ 'Rad sa klijentima' if is_sr else 'Working with clients' }}</h3>
            <p>
              {% if is_sr %}
                {{ therapist.name }} radi sa klijentima online i uživo u Beogradu, u trajanju od oko 50 minuta po seansi.
                Fokus je na praktičnim, dokazanim tehnikama i toplom, podržavajućem pristupu.
              {% else %}
                {{ therapist.name }} works with clients online and in person in Belgrade. Sessions last about 50 minutes.
                The approach is practical, evidence-based, and supportive.
              {% endif %}
            </p>

            <p class="read-more"
               data-open-label="{{ 'Cene' if is_sr else 'Details' }}"
               data-closed-label="{{ 'Saznaj više' if is_sr else 'Read more' }}">
              {{ 'Saznaj više' if is_sr else 'Read more' }}
            </p>

            <div class="prices-text">
              <div class="prices-description">
                <p>
                  {% if is_sr %}
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque suscipit arcu sit amet
                    pulvinar hendrerit. Integer in arcu sed nibh imperdiet aliquet. (Zamenite stvarnim opisom pristupa/metoda.)
                  {% else %}
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque suscipit arcu sit amet
                    pulvinar hendrerit. Replace this with real method/approach copy in English.
                  {% endif %}
                </p>
              </div>
              <div class="all-prices">
                {% if is_sr %}
                  <p><span>Individualno:</span> 50 min (cena po stranici Cene)</p>
                  <p><span>Jezici:</span> Srpski, Engleski (dodatak prema stranici Cene)</p>
                  <p><span>Format:</span> Online ili uživo</p>
                {% else %}
                  <p><span>Individual:</span> ~50 min (see Pricing page)</p>
                  <p><span>Languages:</span> Serbian, English (English surcharge per Pricing)</p>
                  <p><span>Format:</span> Online or in-person</p>
                {% endif %}
              </div>
            </div>
          </div>

          <div class="prices-img">
            <img src="{{ url_for('static', filename=therapist.image) }}"
                 alt="{{ therapist.name }} — {{ 'seansa' if is_sr else 'session' }}">
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Wave: details -> contact -->
  <div class="wave-sep" style="--top:#f5ffe5; --bottom:#889b6d;">
    <svg viewBox="0 0 1440 200" preserveAspectRatio="none" aria-hidden="true">
      <rect width="1440" height="200" fill="var(--bottom)"></rect>
      <path d="M0,60 C240,140 600,0 900,60 C1120,105 1280,120 1440,80 L1440,0 L0,0 Z" fill="var(--top)"></path>
    </svg>
  </div>

  <!-- =============== CONTACT (same as index) =============== -->
  <section id="contact" class="section section--contact">
    <div class="container">
      <div id="contact-info"></div>
      <div class="form">
        <form action="https://usebasin.com/f/52e7368d9d9c" method="POST" enctype="multipart/form-data" id="form">
          <label for="contact-name">{{ 'Vaše ime' if is_sr else 'First name' }}</label>
          <input type="text" name="name" id="contact-name">

          <label for="contact-lastname">{{ 'Vaše prezime' if is_sr else 'Last name' }}</label>
          <input type="text" name="lastname" id="contact-lastname">

          <label for="contact-email">Email</label>
          <input type="email" name="email" id="contact-email" required>

          <label for="contact-phone">{{ 'Telefon' if is_sr else 'Phone' }}</label>
          <input type="text" name="phone" id="contact-phone">

          <label for="contact-title">{{ 'Naslov' if is_sr else 'Subject' }}</label>
          <input type="text" name="title" id="contact-title">

          <label for="contact-message">{{ 'Poruka' if is_sr else 'Message' }}</label>
          <textarea name="message" id="contact-message"></textarea>

          <button type="submit">{{ 'Pošalji' if is_sr else 'Send' }}</button>
        </form>
      </div>
    </div>
  </section>

</main>

<!-- Localized read-more toggle -->
<script>
  for (let readMore of document.getElementsByClassName('read-more')) {
    const OPEN = readMore.getAttribute('data-open-label') || 'Details';
    const CLOSED = readMore.getAttribute('data-closed-label') || 'Read more';
    readMore.addEventListener('click', () => {
      const wrap = readMore.closest('.prices-single');
      const pricesImg = wrap?.querySelector('.prices-img');
      const pricesText = readMore.parentNode.querySelector('.prices-text');
      const desc = pricesText.querySelector('.prices-description');
      const all  = pricesText.querySelector('.all-prices');

      const open = !readMore.classList.contains('active');
      desc.style.transform = open ? 'scale(100%)' : 'scale(0%)';
      all.style.transform  = open ? 'scale(0%)'   : 'scale(100%)';
      readMore.classList.toggle('active', open);
      readMore.textContent = open ? OPEN : CLOSED;
      if (pricesImg) pricesImg.style.flex = open ? '0' : '1';
    });
  }
</script>

{% if therapist %}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Person",
  "name":"{{ therapist.name }}",
  "image":"https://your-domain.com/{{ url_for('static', filename=therapist.image) }}",
  "jobTitle":"{{ therapist.titles[0] if therapist.titles else 'Psychologist' }}",
  "affiliation":{"@type":"Organization","name":"RESET"},
  "knowsAbout":[{% for tag in therapist.focus %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}],
  "worksFor":{"@type":"Organization","name":"RESET"},
  "url":"{{ request.url }}"
}
</script>
<script src="{{ url_for('static', filename='js/nav.js') }}"></script>
{% endif %}


{% endblock %}
